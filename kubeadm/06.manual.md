# MSA/kubeadm 운영 메뉴얼 (종합)

01~05 문서를 순서대로 적용했을 때의 전체 흐름과, 일상적인 운영·점검·트러블슈팅을 한곳에서 참조하기 위한 메뉴얼입니다.

---

## 문서 순서 및 역할

| 순서 | 파일명 | 내용 |
|------|--------|------|
| 01 | 01.kubeadm-rocky-single-node-containerd.md | Kubernetes 단일 노드 구축 (Rocky Linux + containerd) |
| 02 | 02.docker-registry.md | Docker Registry 설치 (Private 레지스트리, Jenkins/클러스터 연동) |
| 03 | 03.gitlab-source.md | GitLab 소스관리 (저장소 구조, Jenkins/Argo CD 연동) |
| 04 | 04.jenkins-build.md | Jenkins CI 빌드 (Linux 직접 설치, 파이프라인, 이미지 빌드·푸시) |
| 05 | 05.argocd-deploy.md | Argo CD 배포 (Git 기반 배포·동기화) |
| 06 | 06.manual.md | 종합 메뉴얼 (본 문서) |
| 07 | 07.tomcat-war-deploy.md | Tomcat + WAR Kubernetes 배포 (이미지 빌드·Deployment·Service) |
| 08 | 08.jenkins-tomcat-deploy.md | Jenkins로 Tomcat WAR 빌드·배포 (04+07 연계) |

---

## 설치 요약 (문서별 설치 내용)

| 컴포넌트 | 설치 방법 | 설치 위치·검증 |
|----------|-----------|----------------|
| Kubernetes | kubeadm (Rocky + containerd) | 01문서 전부, `kubectl get nodes` |
| kubectl | 01 또는 04 문서의 "설치 전 확인" | `kubectl version --client` |
| Docker Registry | 02: Docker 컨테이너 (registry:2) | `docker ps \| grep registry`, https://\<노드IP\>:5000 |
| GitLab (선택) | 03: Kubernetes(Helm) 또는 Docker | 03 "GitLab 서버 설치" 절 |
| Git 클라이언트 | 03: dnf / 공식 설치 프로그램 | `git --version` |
| Jenkins | 04: Linux 직접 설치 (systemd) | `sudo systemctl status jenkins`, http://\<서버IP\>:8080 |
| Argo CD | 05: manifest install.yaml | `kubectl get pods -n argocd`, Argo CD UI |
| Argo CD CLI | 05: 1-4절 (Linux/Windows/macOS) | `argocd version --client` |
| Tomcat WAR 앱 | 07: Dockerfile + Deployment/Service | `kubectl get pods -n dev` |
| Jenkins → Tomcat 배포 | 08: 04+07 연계 (WAR 빌드 → 이미지 푸시 → kubectl 배포) | 08번 문서 6단계 확인 |

---

## 전체 구축 순서 (권장)

1. **인프라**  
   - 01: kubeadm으로 Kubernetes 단일 노드 설치 (Rocky Linux + containerd)

2. **레지스트리**  
   - 02: Docker Registry 설치 (Private 레지스트리, containerd/Jenkins 연동)

3. **소스관리**  
   - 03: GitLab에서 저장소 생성, 브랜치 전략, Jenkins/Argo CD용 인증 준비

4. **빌드**  
   - 04: Jenkins 설치 및 파이프라인 Job 구성, GitLab 연동, 이미지 빌드·푸시(02 Registry)

5. **배포**  
   - 05: Argo CD 설치, GitLab 저장소 연동, Application 생성 및 자동/수동 Sync

6. **Tomcat WAR 배포 (선택)**  
   - 07: 수동 이미지 빌드·배포  
   - 08: Jenkins 파이프라인으로 WAR 빌드 → 이미지 푸시 → Kubernetes 배포

7. **운영**  
   - 06: 아래 일상 점검·트러블슈팅 참고

---

## 일상 점검 명령어

### Kubernetes 클러스터
```bash
kubectl get nodes
kubectl get pods -A
kubectl get svc -A
```

### Jenkins
```bash
sudo systemctl status jenkins
sudo journalctl -u jenkins -f --tail=100
# 초기 비밀번호: sudo cat /data/jenkins/secrets/initialAdminPassword
```

### Argo CD
```bash
kubectl get pods -n argocd
kubectl get applications -n argocd
argocd app list   # CLI 사용 시
```

### 시스템 서비스 (노드에서)
```bash
sudo systemctl status containerd
sudo systemctl status kubelet
```

---

## 트러블슈팅 체크리스트

| 현상 | 확인 위치 | 참고 문서 |
|------|-----------|-----------|
| Pod가 Pending | `kubectl describe pod <pod> -n <ns>`, `kubectl get nodes` | 01 |
| 이미지 Pull 실패 | 레지스트리 접근, imagePullSecrets | 02, 05 |
| Jenkins 빌드 실패 | Job Console Output, Credentials, Git URL, Registry | 04, 03 |
| Argo CD OutOfSync | Application Sync 결과, Git 경로·브랜치 | 05, 03 |
| GitLab 연결 실패 | Jenkins/Argo CD Credentials, 네트워크, 토큰 만료 | 03 |

---

## 요약

- **01** → 클러스터 준비  
- **02** → Private Docker Registry  
- **03** → 소스·배포 매니페스트 저장소 및 연동 준비 (GitLab)  
- **04** → 빌드 파이프라인 (Jenkins)  
- **05** → 배포 파이프라인 (Argo CD)  
- **06** → 구축 순서·일상 점검·트러블슈팅 참고  
- **07** → Tomcat WAR 수동 배포  
- **08** → Jenkins로 Tomcat WAR 빌드·배포 (04+07 연계)

추가 기능 도입 시 기존 기능은 유지한 채, 해당 단계 문서를 보완하거나 새 문서를 순차 번호로 추가하는 것을 권장합니다.
