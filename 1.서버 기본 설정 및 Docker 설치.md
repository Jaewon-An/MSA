## 1단계: 서버 기본 설정 및 Docker 설치

### 1-1. 시스템 업데이트 및 기본 패키지 설치
```bash
# 1. 시스템 업데이트
sudo dnf update -y

# 2. 필수 패키지 설치
sudo dnf install -y curl wget git vim net-tools yum-utils

# 3. 확인
curl --version
git --version
```

**실행 후 출력 예상:**
```
curl 7.x.x
git version 2.x.x
```

### 1-2. SELinux 설정 (Permissive 모드로 변경)
```bash
# 1. 현재 SELinux 상태 확인
getenforce

# 2. SELinux를 Permissive 모드로 변경 (Docker/Kubernetes 호환성)
sudo setenforce 0
sudo sed -i 's/^SELINUX=enforcing$/SELINUX=permissive/' /etc/selinux/config

# 3. 확인
getenforce
```

**예상 출력:**
```
Permissive
```

### 1-3. 방화벽 설정
```bash
# 1. 방화벽 상태 확인
sudo systemctl status firewalld

# 2. 필요한 포트 오픈
sudo firewall-cmd --permanent --add-port=8080/tcp       # Jenkins
sudo firewall-cmd --permanent --add-port=5000/tcp       # Docker Registry
sudo firewall-cmd --permanent --add-port=6443/tcp       # Kubernetes API
sudo firewall-cmd --permanent --add-port=10250/tcp      # Kubelet
sudo firewall-cmd --permanent --add-port=2379-2380/tcp  # etcd
sudo firewall-cmd --permanent --add-port=30000-32767/tcp # NodePort Services

# 3. 방화벽 재시작
sudo firewall-cmd --reload

# 4. 확인
sudo firewall-cmd --list-ports
```

**예상 출력:**
```
8080/tcp 5000/tcp 6443/tcp 10250/tcp 2379-2380/tcp 30000-32767/tcp
```

### 1-4. Docker 저장소 추가 및 설치
```bash
# 1. Docker CE 저장소 추가
sudo dnf config-manager --add-repo https://download.docker.com/linux/centos/docker-ce.repo

# 2. Docker 설치
sudo dnf install -y docker-ce docker-ce-cli containerd.io docker-buildx-plugin docker-compose-plugin

# 3. Docker 서비스 시작 및 활성화
sudo systemctl start docker
sudo systemctl enable docker

# 4. 현재 사용자를 docker 그룹에 추가
sudo usermod -aG docker $USER

# 5. 재로그인 (중요!)
echo "다음 명령을 실행하여 그룹 변경 적용:"
echo "newgrp docker"
```

**명령 실행:**
```bash
newgrp docker
```

### 1-5. Docker 설치 확인
```bash
# 1. Docker 버전 확인
docker --version

# 2. Docker 서비스 상태 확인
sudo systemctl status docker

# 3. Docker 실행 테스트
docker run hello-world

# 4. Docker 정보 확인
docker info | grep -i "server version"
```

**예상 출력:**
```
Docker version 24.0.x, build xxxxx
● docker.service - Docker Application Container Engine
   Loaded: loaded (/usr/lib/systemd/system/docker.service; enabled)
   Active: active (running)
Hello from Docker!
This message shows that your installation appears to be working correctly.
Server Version: 24.0.x
```

### 1-6. Docker 데몬 설정 (선택사항, 성능 최적화)
```bash
# Docker 데몬 설정 파일 생성
sudo mkdir -p /etc/docker
sudo tee /etc/docker/daemon.json > /dev/null <<EOF
{
  "exec-opts": ["native.cgroupdriver=systemd"],
  "log-driver": "json-file",
  "log-opts": {
    "max-size": "100m"
  },
  "storage-driver": "overlay2"
}
EOF

# Docker 재시작
sudo systemctl daemon-reload
sudo systemctl restart docker

# 확인
docker info | grep -i "cgroup driver"
```

**예상 출력:**
```
Cgroup Driver: systemd
```

---

## 1단계 확인사항
다음 항목들이 모두 정상인지 확인해주세요:
- `docker --version` 명령이 버전을 출력하나요?
- `docker run hello-world` 명령이 성공했나요?
- `sudo` 없이 `docker ps` 명령이 실행되나요?
- `getenforce` 명령이 `Permissive`를 출력하나요?
- `sudo firewall-cmd --list-ports` 명령이 포트 목록을 출력하나요?

**확인 명령어 (한 번에 확인):**
```bash
echo "=== Docker 버전 ==="
docker --version

echo -e "\n=== Docker 실행 테스트 ==="
docker ps

echo -e "\n=== SELinux 상태 ==="
getenforce

echo -e "\n=== 방화벽 포트 ==="
sudo firewall-cmd --list-ports

echo -e "\n=== Docker 서비스 상태 ==="
sudo systemctl is-active docker
```
